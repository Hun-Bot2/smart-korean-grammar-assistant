# 바른 한국어 맞춤법 검사기: 개발 회고 및 기술 공유

## 1. 개발 동기 (The "Why?")

### 문제 정의: 기존에 어떤 불편함이 있었나요?

개인 블로그 포스트, 프로젝트의 `README.md`, 또는 기획 문서 등을 한글로 작성할 때가 많은데, VSCode 내에는 만족스러운 수준의 한글 맞춤법 검사기가 부족했다. 
매번 웹 브라우저를 열어 nara-speller라고 하는 특정 검사기 웹사이트에 텍스트를 복사-붙여넣기 하는 과정은 번거로웠고, '하나 만들어서 extension에 출시해보자'라는 생각으로 개발을 하게되었다.

### 목표 설정: 이 Extension을 통해 무엇을 해결하고 싶었나요?

이 Extension의 목표는 명확했습니다. **"코딩과 글쓰기가 이루어지는 VSCode 안에서 모든 것을 해결하자."** 
웹사이트를 오가는 불편함 없이, 코드 에디터에서 실시간으로 한글 맞춤법 오류를 확인하고, 클릭 한 번으로 수정 제안을 적용할 수 있는 통합된 글쓰기 환경을 제공하는 것이 목표였습니다.

## 2. 핵심 기술 및 아키텍처 (The "How?")

### 사용한 API: 왜 '부산대학교 인공지능연구실의 한국어 문법 검사기' API를 선택했나요?

여러 대안(네이버, 다음 등)을 검토했지만, 최종적으로 '부산대학교 인공지능연구실(나라인포테크)의 한국어 문법 검사기' API를 선택했습니다. 그 이유는 다음과 같습니다.

*   **높은 품질과 전문성:** 이 API는 한국어 자연어 처리(NLP) 분야에서 오랜 기간 연구된 결과물로, 단순 맞춤법을 넘어 문맥을 고려한 교정 제안 등 매우 높은 품질을 보여줍니다.
*   **비교적 관대한 사용 정책:** 비상업적 목적에 대해 비교적 자유로운 사용을 허용하여, 오픈소스 프로젝트에 적용하기에 적합했습니다.
*   **상세한 오류 정보:** API 응답이 단순히 대체 단어만 제공하는 것이 아니라, 오류의 원인과 상세한 설명까지 포함하고 있어 사용자에게 더 유용한 피드백을 줄 수 있었습니다.

### VSCode Extension API: 개발 과정에서 어떤 VSCode API를 핵심적으로 사용했나요?

이 Extension은 VSCode의 다양한 API를 유기적으로 활용하여 만들어졌습니다.

*   `vscode.languages.createDiagnosticCollection`: 검사 결과 발견된 오류를 편집기 상에 시각적으로 표시(빨간 밑줄 등)하는 데 사용됩니다.
*   `vscode.languages.registerCodeActionsProvider`: 오류가 발생한 부분에서 사용자가 '빠른 수정(Quick Fix)'을 실행할 수 있도록, 수정 제안 목록을 제공하는 역할을 합니다.
*   `vscode.languages.registerHoverProvider`: 오류 부분에 마우스를 올렸을 때, API가 제공하는 상세한 오류 설명과 교정 내용을 보여주는 툴팁을 구현하는 데 사용됩니다.
*   `vscode.workspace.onDidChangeTextDocument`: 사용자가 문서를 수정할 때마다 이벤트를 감지하여, 실시간으로 맞춤법 검사를 다시 수행하고 결과를 업데이트하는 데 핵심적인 역할을 합니다.

### 프로젝트 구조

*   `src/extension.ts`: Extension의 심장부입니다. Extension이 활성화될 때 실행되며, 각종 VSCode API Provider를 등록하고, 문서 변경/저장과 같은 이벤트를 감지하여 다른 모듈을 호출하는 역할을 합니다.
*   `src/bareunClient.ts`: '부산대 맞춤법 검사기' API와의 모든 통신을 담당합니다. 텍스트를 보내고, 응답(JSON)을 받아 파싱하는 로직이 포함되어 있습니다.
*   `src/diagnostics.ts`: `bareunClient`를 통해 받은 오류 정보를 VSCode가 이해할 수 있는 `Diagnostic` 객체로 변환합니다. 오류의 위치, 심각도, 메시지 등을 설정하여 에디터에 표시하는 역할을 합니다.
*   `src/codeActions.ts`: `Diagnostic` 정보를 바탕으로 '빠른 수정' 항목을 생성합니다. 사용자가 특정 수정안을 선택했을 때, 실제로 문서 내용을 변경하는 로직을 담당합니다.
*   `src/hoverProvider.ts`: 오류 위치에 마우스를 올렸을 때, 어떤 내용을 보여줄지를 정의합니다.

## 3. 개발 과정 및 문제 해결 (The "Journey")

### 가장 큰 어려움: 개발 중 가장 어려웠던 점은 무엇이었나요?

가장 큰 어려움은 **API 응답으로 받은 오류 위치와 VSCode 문서 상의 실제 위치를 정확히 매핑하는 것**이었습니다. API는 평문(Plain Text)을 기준으로 오류 위치를 반환하지만, 사용자가 작성하는 문서는 Markdown과 같은 형식일 수 있습니다. 예를 들어, Markdown의 코드 블록(` ``` `) 안에 있는 내용은 검사에서 제외해야 했고, 이로 인해 API가 인식하는 텍스트와 실제 문서의 텍스트 사이에 인덱스 불일치 문제가 발생했습니다.

### 문제 해결 과정: 그 어려움을 어떻게 해결했나요?

이 문제를 해결하기 위해 `src/util/markdownFilter.ts` 라는 모듈을 만들었습니다.

1.  **검사 전 처리:** API로 텍스트를 보내기 전에, `markdownFilter`를 사용해 Markdown 문서에서 코드 블록, 인라인 코드, 링크 URL 등 검사가 불필요한 부분을 찾아 임시로 공백 문자로 치환합니다. 동시에 원본 텍스트에서의 각 부분의 위치(인덱스)를 따로 저장해 둡니다.
2.  **API 검사:** 이렇게 '정제된' 텍스트를 API로 보내 검사를 수행합니다. API는 정제된 텍스트를 기준으로 오류 위치를 반환합니다.
3.  **위치 재계산:** API가 반환한 오류 위치를, 1번 단계에서 저장해 둔 원본 위치 정보를 바탕으로 다시 계산하여 VSCode 문서의 정확한 위치로 변환합니다.

이 과정을 통해 Markdown 문서에서도 코드 부분은 건드리지 않고, 순수한 한글 텍스트에 대해서만 정확한 위치에 오류를 표시하고 수정할 수 있게 되었습니다.

### 인상 깊었던 코드: 직접 작성한 코드 중 가장 마음에 들거나, '아하!' 했던 순간의 코드가 있다면 공유해주세요.

`src/diagnostics.ts` 파일에서 API 응답을 `Diagnostic` 객체로 변환하는 부분이 인상 깊었습니다. 특히, 하나의 오류에 대해 여러 개의 대치어를 제안하는 경우가 있는데, 이 모든 정보를 `Diagnostic` 객체에 포함시켜 `CodeAction`에서 활용할 수 있도록 설계한 부분이 기억에 남습니다.

```typescript
// In diagnostics.ts (Simplified)
const diagnostic = new vscode.Diagnostic(range, message, severity);
diagnostic.source = '스마트 맞춤법 검사기';
// 사용자 정의 정보를 Diagnostic 객체에 포함시켜 다른 모듈에서 활용
diagnostic.code = {
    value: error.error_code,
    target: JSON.stringify(error.suggestions) // 대치어 정보를 JSON 문자열로 저장
};
```

이렇게 `diagnostic.code`에 추가 정보를 담아두니, `codeActions.ts`에서는 이 정보를 다시 파싱하여 여러 개의 '빠른 수정' 옵션을 동적으로 생성해줄 수 있었습니다. 이는 VSCode API의 유연성을 잘 활용한 사례라고 생각합니다.

## 4. 주요 기능 및 사용법 (The "What?")

### 핵심 기능

*   **실시간 맞춤법/문법 검사:** 글을 작성하는 동시에 오류를 감지하여 빨간색 밑줄로 표시합니다.
*   **띄어쓰기 교정:** 잘못된 띄어쓰기를 감지하고 올바른 띄어쓰기를 제안합니다.
*   **대치어 제안:** 문맥에 더 적합하거나 표준어인 단어를 여러 개 제안하고, 사용자가 선택하여 수정할 수 있습니다.
*   **빠른 수정(Quick Fix):** 오류 부분에 커서를 놓고 `Cmd + .` (macOS) 또는 `Ctrl + .` (Windows)를 누르면 제시된 수정안을 바로 적용할 수 있습니다.
*   **상세 설명(Hover):** 오류에 마우스를 올리면 왜 틀렸는지, 어떻게 고쳐야 하는지에 대한 상세한 설명을 볼 수 있습니다.

### 사용자 시나리오

*   **기술 블로거:** VSCode에서 Markdown으로 블로그 포스트를 작성하면서 실시간으로 글의 완성도를 높일 수 있습니다.
*   **오픈소스 기여자:** `README.md`나 기여 가이드 문서를 한글로 작성할 때, 더 정확하고 전문적인 인상을 줄 수 있습니다.
*   **학생 및 작가:** 리포트, 에세이 등 각종 한글 문서를 VSCode로 작성하는 모든 사용자에게 유용합니다.

## 5. 결과 및 향후 계획 (The "Next")

### 결과물: 완성된 Extension을 사용해보니 어떤 점이 좋아졌나요?

가장 큰 변화는 **글쓰기 경험의 향상**입니다. 더 이상 맞춤법 검사를 위해 다른 창을 띄울 필요가 없어졌고, 온전히 글쓰기에만 집중할 수 있게 되었습니다. 개인적으로는 기술 문서나 이메일을 작성할 때 자신감이 더 붙었고, 결과적으로 생산성이 크게 향상되었습니다.

### 향후 계획

*   **개인 API 키 등록 시스템:** 현재는 공용 API를 사용하고 있지만, 향후 각 사용자가 bareun.ai에서 개인 API 키를 발급받아 Extension에 등록할 수 있는 시스템을 구축할 계획입니다. 이를 통해 더 안정적이고 개인화된 서비스를 제공할 수 있습니다. 또한 간단한 외부 가입 절차를 통해 누구나 쉽게 시작할 수 있도록 개선할 예정입니다.
*   **사용자 사전 인터페이스:** 사용자가 자주 사용하는 고유명사, 전문 용어, 신조어 등을 쉽게 등록하고 관리할 수 있는 직관적인 인터페이스를 제공할 계획입니다. 사용자 사전은 온라인으로 등록되어 API 키 단위로 제한 없이 관리할 수 있으며, 이를 통해 훨씬 더 정확하고 개인화된 맞춤법 검사 결과를 얻을 수 있습니다.
*   **성능 최적화:** 매우 긴 문서의 경우, 타이핑 시 약간의 지연이 발생할 수 있습니다. Debouncing과 같은 기술을 적용하여 불필요한 API 호출을 줄여 성능을 개선하고 싶습니다.
*   **더 많은 교정 옵션:** 문체(격식체, 비격식체) 변경 제안 등 더 고도화된 교정 기능을 추가하는 것을 장기적인 목표로 하고 있습니다.

### 설치 및 기여 안내

**[VSCode Marketplace에서 설치하기](https://marketplace.visualstudio.com/items?itemName=Hun-Bot2.smart-korean-grammar-assistant)** (가상 링크)

이 프로젝트는 오픈소스입니다. 버그 리포트, 기능 제안, 코드 기여 등 어떤 형태의 참여든 환영합니다.

**[GitHub 리포지토리 바로가기](https://github.com/Hun-Bot2/smart-korean-grammer-assistant)**
